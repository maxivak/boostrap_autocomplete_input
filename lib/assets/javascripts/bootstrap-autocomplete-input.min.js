var autocomplete_data_static={};function autocomplete_get_hidden_field(t){var a=t.attr("data-field-id");return!!a&&(a=a.replace(/(:|\.|\[|\])/g,"\\$1"),$("#"+a))}function autocomplete_query(c){c.typeahead({source:function(t,a){c=this.$element,rows=[];var e=c.attr("name"),o=c.data("func-params"),i={};o&&(i=window[o]()),i.q=t,$.getJSON(c.attr("data-source-query"),i,function(t){autocomplete_data_static[e]={map:[],values:[]},$.each(t,function(t,a){autocomplete_data_static[e].values.push(a[1]),autocomplete_data_static[e].map[a[1]]=a[0]}),a(autocomplete_data_static[e].values)})},updater:function(t){var a=autocomplete_get_hidden_field(c=this.$element);if(a){var e=c.attr("name");a.val(autocomplete_data_static[e].map[t])}return t},items:c.attr("data-items"),minLength:c.attr("data-min-length"),afterSelect:function(t){var a=c.attr("data-afterSelect")||"";if(""!=a){var e=window[a];"function"==typeof e&&e(t)}}}).on("change",function(t){var a=$(this),e=a.typeahead("getActive"),o=autocomplete_get_hidden_field(a);o&&(e&&e==a.val()||o&&o.val(""))})}function autocomplete_init(){$('input[data-provide="typeahead"][data-source-array]').each(function(){obj=$(this);var t=JSON.parse(obj.attr("data-source-array").replace(/&quot;/g,'"'));obj.typeahead({source:t,items:obj.attr("data-items"),minLength:obj.attr("data-min-length")})}),$('input[data-provide="typeahead"][data-source]').each(function(){obj=$(this);var e=obj.attr("id");autocomplete_data_static[e]={map:[],values:[]},$.get(obj.attr("data-source"),function(t){$.each(t,function(t,a){autocomplete_data_static[e].values.push(a[1]),autocomplete_data_static[e].map[a[1]]=a[0]}),obj.typeahead({source:autocomplete_data_static[e].values,updater:function(t){return obj_id=$("#"+obj.attr("data-field-id")),obj_id&&obj_id.val(autocomplete_data_static[e].map[t]),t},items:obj.attr("data-items"),minLength:obj.attr("data-min-length")})},"json")}),$('input[data-provide="typeahead"][data-source-query]').each(function(){autocomplete_query($(this))})}